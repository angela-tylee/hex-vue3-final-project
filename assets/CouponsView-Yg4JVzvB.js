import{a as b,S as r}from"./sweetalert2.all-3NlZ93nL.js";import{M as g}from"./bootstrap.esm-TTjMTX3M.js";import{_ as C,r as M,o as n,c as d,b as t,F as y,i as k,f as V,g as c,t as i,k as p,l as f,Q as P,d as L}from"./index-niEC8eyb.js";var B={VITE_API_URL:"https://ec-course-api.hexschool.io/v2",VITE_API_PATH:"angelalee",BASE_URL:"/hex-vue3-final-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API_URL:m,VITE_API_PATH:h}=B;let _="",v="";const E={data(){return{coupons:[],temp:{},isNew:!1,status:{listLoading:!1}}},methods:{getData(){const l=`${m}/api/${h}/admin/coupons`;this.status.listLoading=!0,b.get(l).then(e=>{this.coupons=e.data.coupons,this.status.listLoading=!1}).catch(e=>{r.fire({title:e.response.data.message,confirmButtonColor:"var(--bs-danger)"}),this.status.listLoading=!1,e.response.status===401&&this.$router.push("/log-in")})},updateCoupon(){let l=`${m}/api/${h}/admin/coupon`,e="post";this.isNew||(l=`${m}/api/${h}/admin/coupon/${this.temp.id}`,e="put"),b[e](l,{data:this.temp}).then(u=>{r.fire({title:u.data.message,icon:"success",confirmButtonColor:"var(--bs-primary)",iconColor:"var(--bs-primary)"}),_.hide(),this.getData()}).catch(u=>{r.fire({title:u.response.data.message,confirmButtonColor:"var(--bs-danger)"})})},openModal(l,e){l==="new"?(this.temp={imagesUrl:[]},this.isNew=!0,_.show()):l==="edit"?(this.temp={...e},this.isNew=!1,_.show()):l==="delete"&&(this.temp={...e},v.show())},delCoupon(){const l=`${m}/api/${h}/admin/coupon/${this.temp.id}`;b.delete(l).then(e=>{r.fire({title:e.data.message,icon:"success",confirmButtonColor:"var(--bs-primary)",iconColor:"var(--bs-primary)"}),v.hide(),this.getData()}).catch(e=>{r.fire({title:e.response.data.message,confirmButtonColor:"var(--bs-danger)"})})}},mounted(){this.getData(),_=new g(document.getElementById("productModal")),v=new g(document.getElementById("delProductModal"))}},I={class:"row py-3"},D=t("h2",null,"折扣碼列表",-1),T={class:"btn-group mt-3"},U={class:"table table-hover mt-4"},A=t("thead",null,[t("tr",null,[t("th",{width:"150px"},"標題"),t("th",{width:"120px"},"折扣碼"),t("th",{width:"50px"},"折扣"),t("th",{width:"80px"},"是否啟用"),t("th",{width:"120px"},"編輯")])],-1),R={key:0,class:"text-success"},N={key:1},S={class:"btn-group"},F=["onClick"],H=["onClick"],O={key:0,class:"loading"},j=t("div",{class:"spinner-border text-primary",role:"status"},null,-1),Q=[j],q={id:"productModal",ref:"productModal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},z={class:"modal-dialog modal-xl"},G={class:"modal-content border-0"},J=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{id:"productModalLabel",class:"modal-title"},[t("span",{class:"text-white"},"編輯折扣碼")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),K={class:"modal-body"},W={class:"row"},X={class:"col-sm-8"},Y={class:"mb-3 col-md-6"},Z=t("label",{for:"title",class:"form-label"},"標題",-1),$={class:"row"},tt={class:"mb-3 col-md-6"},et=t("label",{for:"author",class:"form-label"},"折扣碼",-1),st={class:"row"},ot={class:"mb-3 col-md-6"},lt=t("label",{for:"author",class:"form-label"},"折扣比例",-1),at=t("hr",null,null,-1),nt={class:"mb-3"},dt={class:"form-check"},it=t("label",{class:"form-check-label",for:"isPublic"},"是否啟用",-1),rt={class:"modal-footer"},ct=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),ut={id:"delProductModal",ref:"delProductModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},pt={class:"modal-dialog"},mt={class:"modal-content border-0"},ht=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delProductModalLabel",class:"modal-title"},[t("span",{class:"text-white"},"刪除折扣碼")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),_t={class:"modal-body"},bt={class:"text-danger"},ft={class:"modal-footer"},vt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function gt(l,e,u,yt,o,a){const x=M("RouterView");return n(),d(y,null,[t("div",I,[t("div",null,[D,t("div",T,[t("button",{type:"button",class:"btn btn-primary btn-sm",onClick:e[0]||(e[0]=s=>a.openModal("new"))}," 新增折扣碼 ")]),t("table",U,[A,t("tbody",null,[(n(!0),d(y,null,k(o.coupons,s=>(n(),d("tr",{key:s.id},[t("td",null,i(s.title),1),t("td",null,i(s.code),1),t("td",null,i(s.percent)+"%",1),t("td",null,[s.is_enabled===1?(n(),d("span",R,"已啟用")):(n(),d("span",N,"未啟用"))]),t("td",null,[t("div",S,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:w=>a.openModal("edit",s)}," 編輯 ",8,F),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:w=>a.openModal("delete",s)}," 刪除 ",8,H)])])]))),128))])]),o.status.listLoading?(n(),d("div",O,Q)):V("",!0),t("p",null,[c("目前有 "),t("span",null,i(o.coupons.length),1),c(" 個折扣碼")])])]),t("div",q,[t("div",z,[t("div",G,[J,t("div",K,[t("div",W,[t("div",X,[t("div",Y,[Z,p(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入折扣碼標題","onUpdate:modelValue":e[1]||(e[1]=s=>o.temp.title=s)},null,512),[[f,o.temp.title]])]),t("div",$,[t("div",tt,[et,p(t("input",{id:"author",type:"text",class:"form-control",placeholder:"請輸入折扣碼","onUpdate:modelValue":e[2]||(e[2]=s=>o.temp.code=s)},null,512),[[f,o.temp.code]])])]),t("div",st,[t("div",ot,[lt,p(t("input",{id:"author",type:"text",class:"form-control",placeholder:"請輸入折扣比例（例：打7折，輸入70)","onUpdate:modelValue":e[3]||(e[3]=s=>o.temp.percent=s)},null,512),[[f,o.temp.percent]])]),t("p",null,"原價：1000 折扣後金額："+i(1e3*(o.temp.percent/100)),1)]),at,t("div",nt,[t("div",dt,[p(t("input",{id:"isPublic",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[4]||(e[4]=s=>o.temp.is_enabled=s)},null,512),[[P,o.temp.is_enabled]]),it])])])])]),t("div",rt,[ct,t("button",{type:"button",class:"btn btn-primary",onClick:e[5]||(e[5]=(...s)=>a.updateCoupon&&a.updateCoupon(...s))}," 確認 ")])])])],512),t("div",ut,[t("div",pt,[t("div",mt,[ht,t("div",_t,[c(" 是否刪除 "),t("strong",bt,i(o.temp.title),1),c(" 商品(刪除後將無法恢復)。 ")]),t("div",ft,[vt,t("button",{type:"button",class:"btn btn-danger",onClick:e[6]||(e[6]=(...s)=>a.delCoupon&&a.delCoupon(...s))}," 確認刪除 ")])])]),c("- ")],512),L(x)],64)}const Mt=C(E,[["render",gt]]);export{Mt as default};
